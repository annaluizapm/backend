# Deploy na Vercel - Guia Completo

## ğŸ“‹ PrÃ©-requisitos

1. Conta na Vercel (gratuita)
2. Banco de dados MySQL configurado (recomendado: PlanetScale, Railway ou Aiven)
3. Git instalado

## ğŸ”§ ConfiguraÃ§Ãµes Realizadas

### 1. Banco de Dados Serverless
- âœ… ConexÃµes abertas e fechadas a cada requisiÃ§Ã£o
- âœ… Limite de conexÃµes reduzido para 1 (ideal para serverless)
- âœ… Timeout e keep-alive configurados

### 2. Estrutura de Arquivos
```
back/
â”œâ”€â”€ api/
â”‚   â””â”€â”€ index.js       # API principal para Vercel
â”œâ”€â”€ db_config.js       # ConfiguraÃ§Ã£o do banco (serverless)
â”œâ”€â”€ server.js          # Servidor local (desenvolvimento)
â”œâ”€â”€ vercel.json        # ConfiguraÃ§Ã£o Vercel
â”œâ”€â”€ package.json
â””â”€â”€ .env               # VariÃ¡veis de ambiente
```

## ğŸš€ Como Fazer Deploy

### OpÃ§Ã£o 1: Via Vercel CLI

1. **Instalar Vercel CLI**
```bash
npm install -g vercel
```

2. **Login na Vercel**
```bash
vercel login
```

3. **Deploy**
```bash
cd back
vercel
```

4. **Deploy de ProduÃ§Ã£o**
```bash
vercel --prod
```

### OpÃ§Ã£o 2: Via GitHub (Recomendado)

1. **Criar repositÃ³rio no GitHub** (se ainda nÃ£o tiver)
```bash
git remote add origin https://github.com/seu-usuario/micromidia.git
git branch -M main
git push -u origin main
```

2. **Conectar Ã  Vercel**
   - Acesse [vercel.com](https://vercel.com)
   - Clique em "New Project"
   - Importe seu repositÃ³rio GitHub
   - Selecione a pasta `back` como root directory
   - Configure as variÃ¡veis de ambiente (ver abaixo)

## ğŸ” VariÃ¡veis de Ambiente

Configure estas variÃ¡veis na Vercel:

```env
DB_HOST=seu-host-mysql.com
DB_USER=seu-usuario
DB_PASSWORD=sua-senha
DB_NAME=micro_midia
NODE_ENV=production
```

### Como Adicionar na Vercel:
1. No painel do projeto
2. Settings â†’ Environment Variables
3. Adicione cada variÃ¡vel
4. Marque para todos os ambientes (Production, Preview, Development)

## ğŸ“Š Banco de Dados Recomendados (GrÃ¡tis)

### PlanetScale (Recomendado)
- âœ… 5GB grÃ¡tis
- âœ… Otimizado para serverless
- âœ… Escala automÃ¡tica
- ğŸ”— [planetscale.com](https://planetscale.com)

### Railway
- âœ… $5 crÃ©dito mensal grÃ¡tis
- âœ… FÃ¡cil configuraÃ§Ã£o
- ğŸ”— [railway.app](https://railway.app)

### Aiven
- âœ… Plano grÃ¡tis disponÃ­vel
- âœ… MÃºltiplas regiÃµes
- ğŸ”— [aiven.io](https://aiven.io)

## âš™ï¸ ConfiguraÃ§Ã£o do Banco de Dados

1. **Criar o banco de dados** no serviÃ§o escolhido
2. **Executar o SQL** (arquivo `SQL/micro_midia.sql`)
3. **Copiar credenciais** e adicionar na Vercel

## ğŸ§ª Testar Localmente

```bash
# Instalar dependÃªncias
npm install

# Rodar em modo desenvolvimento
npm run dev

# Testar API
curl http://localhost:3002/api/test
```

## âœ… Checklist PrÃ©-Deploy

- [ ] VariÃ¡veis de ambiente configuradas
- [ ] Banco de dados criado e populado
- [ ] CÃ³digo commitado no Git
- [ ] `.env` no `.gitignore`
- [ ] Testado localmente

## ğŸ› Troubleshooting

### Erro: "Too many connections"
- Verifique se `connectionLimit: 1` estÃ¡ em `db_config.js`
- Considere upgrade do plano do banco de dados

### Erro: "ETIMEDOUT" ou "ECONNREFUSED"
- Verifique credenciais do banco
- Certifique-se que o banco aceita conexÃµes externas
- Adicione IP da Vercel na whitelist (se necessÃ¡rio)

### Erro: "Module not found"
- Execute `npm install` novamente
- Verifique se `node_modules` estÃ¡ no `.gitignore`

### Uploads nÃ£o funcionam
- Vercel tem sistema de arquivos read-only
- Considere usar serviÃ§os externos:
  - Cloudinary (imagens)
  - AWS S3
  - Vercel Blob Storage

## ğŸ“ˆ Monitoramento

- Logs: `vercel logs [deployment-url]`
- Analytics: Painel da Vercel
- Errors: Vercel â†’ Seu Projeto â†’ Functions

## ğŸ¯ PrÃ³ximos Passos

1. **DomÃ­nio Customizado**: Configure em Vercel â†’ Settings â†’ Domains
2. **HTTPS**: AutomÃ¡tico na Vercel
3. **CDN**: JÃ¡ incluso
4. **Monitoramento**: Configure alertas

## ğŸ“ Suporte

- DocumentaÃ§Ã£o Vercel: [vercel.com/docs](https://vercel.com/docs)
- Comunidade: [github.com/vercel/vercel/discussions](https://github.com/vercel/vercel/discussions)
